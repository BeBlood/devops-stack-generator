version: '2'

services:

    gitlab:
      container_name: ${GITLAB_CONTAINER_NAME}
      image: gitlab/gitlab-ce:latest
      environment:
        - SMTP_ENABLED=true
        - SMTP_USER=${GITLAB_SMTP_USER}
        - SMTP_PASSWORD=${GITLAB_SMTP_PASSWORD}
        - VIRTUAL_HOST=${GITLAB_VIRTUAL_HOST}
        - GITLAB_OMNIBUS_CONFIG="gitlab_rails['gitlab_ssh_host'] = '${GITLAB_SSH_URL}';"
      ports:
        - "3000:80"
        - "22:22"
        - "3001:443"
      volumes:
        - /data/gitlab/config:/etc/gitlab
        - /data/gitlab/logs:/var/log/gitlab
        - /data/gitlab/data:/var/opt/gitlab
      #restart: always

networks:
  default:
    external:
      name: ${NETWORK_NAME}
